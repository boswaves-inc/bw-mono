DROP VIEW "public"."cart_data";--> statement-breakpoint
CREATE VIEW "public"."cart_data" AS (select "cart_info"."id", "cart_info"."uid", json_agg(json_build_object('id', "cart_item"."item_id", 'type', "cart_item"."item_tpe", 'created_at', "cart_item"."created_at", 'updated_at', "cart_item"."updated_at")) FILTER (WHERE "cart_item"."item_tpe" = 'script') as "items", ARRAY_AGG("cart_item"."item_id") as "coupons", "cart_info"."created_at", max("cart_item"."updated_at") as "updated_at" from "cart_info" inner join "cart_item" on "cart_item"."cart_id" = "cart_info"."id" group by "cart_info"."id");